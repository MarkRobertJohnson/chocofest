##AH:UseTextMode
module EnsureChocolateyPackages<%ChocolateyPackages>
{
    set $ChocolateyPackagesBuildJson = >>
{
    "git.install": "2.18.0",
    "nodejs.install": "10.11.0",
}
>>;

    set %ChocolateyPackages = %FromJson($ChocolateyPackagesBuildJson);

    # Loop over Module list to install
    foreach $packageName in @MapKeys(%ChocolateyPackages)
    {
        set $packageVersion = %ChocolateyPackages[$packageName];

        Log-Information Ensuring Chocolatey package $packageName $packageVersion;

        PSDsc cChoco::cchocopackageinstaller
        (
            Otter_ConfigurationKey: Name,
            Name: $PackageName,
            Version: $PackageVersion,
            Ensure: Present,
            AutoUpgrade: True,
            Params: "--no-progress --limit-output"
        );
    
    }
}
