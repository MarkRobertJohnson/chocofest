##AH:UseTextMode
module EnsureChocolateyPackages<%ChocolateyPackages, $Source = "">
{
    # Loop over Module list to install
    foreach $packageName in @MapKeys(%ChocolateyPackages)
    {
        set $packageVersion = %ChocolateyPackages[$packageName];

        Log-Information Ensuring Chocolatey package $packageName $packageVersion;

        #Chocolatey::Ensure-Package
        #(
        #    Name: $PackageName,
        #    Version: $PackageVersion,
        #    Source: $Source
        #);
        
        PSDsc chocolatey:ChocolateyPackage (
          Name: $PackageName,
          Version: $PackageVersion,
          Ensure: Present
        );
    }
}
