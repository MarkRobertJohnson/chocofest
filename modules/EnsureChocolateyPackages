##AH:UseTextMode
module EnsureChocolateyPackages<%ChocolateyPackages, $Source = "">
{
    # Loop over Module list to install
    foreach $packageName in @MapKeys(%ChocolateyPackages)
    {
        set $packageVersion = %PowershellModules[$packageName];

        Log-Information Ensuring Chocolatey package $packageName $packageVersion;

        Chocolatey::Ensure-Package
        (
            Name: $PackageName,
            Version: $PackageVersion,
            Source: $Source
        );
    }
}
